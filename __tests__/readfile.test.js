import { readFile, getFraudlentCards } from '../readFile';

describe('When reading transaction from file', () => {
  test('When file is not present', async () => {
    try {
      await readFile('data1.csv', 1500);
    } catch (e) {
      expect(e).toBeDefined();
    }
  });
  test('When file is present, get the card data object', async () => {
    const response = await readFile('data.csv', 1500);
    expect(response).toEqual({
      '10d7ce2f43e35fa57d1bbf8b1e2': [
        ['2020-12-01T13:15:54', 103],
        ['2020-12-01T15:20:22', 400],
        ['2020-12-01T17:45:22', 200],
        ['2020-12-01T21:21:56', 570],
        ['2020-12-01T22:20:22', 400],
        ['2020-12-02T01:50:22', 110],
        ['2020-12-02T02:15:54', 103],
        ['2020-12-02T05:20:22', 400],
        ['2020-12-02T07:45:22', 200],
        ['2020-12-02T11:21:56', 570],
        ['2020-12-02T12:20:22', 400],
        ['2020-12-02T14:50:22', 110],
        ['2020-12-02T20:50:22', 110],
      ],
      '10d7ce2f43e35fa57d1bbf8b1e3': [
        ['2020-12-01T14:21:56', 570],
        ['2020-12-01T18:50:22', 110],
        ['2020-12-01T20:15:54', 103],
        ['2020-12-02T00:45:22', 200],
        ['2020-12-02T01:59:22', 130],
        ['2020-12-02T03:21:56', 570],
        ['2020-12-02T06:39:22', 900],
        ['2020-12-02T08:50:22', 110],
        ['2020-12-02T09:59:22', 130],
        ['2020-12-02T10:15:54', 103],
        ['2020-12-02T13:39:22', 900],
        ['2020-12-02T14:45:22', 200],
        ['2020-12-02T15:59:22', 130],
        ['2020-12-02T18:39:22', 80],
      ],
      '10d7ce2f43e35fa57d1bbf8b1e4': [
        ['2020-12-01T16:39:22', 200],
        ['2020-12-01T19:59:22', 130],
        ['2020-12-01T23:39:22', 90],
        ['2020-12-02T16:21:56', 70],
        ['2020-12-02T17:20:22', 90],
        ['2020-12-02T19:45:22', 20],
        ['2020-12-02T21:59:22', 10],
      ],
    });
  });
  test('Given csv file, get the card numbers which are fraudlent', async () => {
    const response = await getFraudlentCards(1500, 'data.csv');
    expect(response).toEqual([
      '10d7ce2f43e35fa57d1bbf8b1e2',
      '10d7ce2f43e35fa57d1bbf8b1e3',
    ]);
  });
});
